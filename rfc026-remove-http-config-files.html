<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable = no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation-essential/6.2.2/css/foundation.min.css">
    <style>
      a { color: #f18b21; }
      a:hover, a:focus { color: #3f5364; }
    </style>
    <title>Chef RFCs</title>
  </head>
  <body>
    <div class="row medium-12 columns">
      <header class="clearfix">
        <div class="left">
          <a href="/chef-rfc"><h1>Chef RFCs</h1></a>
        </div>
      </header>
<h1>Remove HTTP Config Files</h1>

<p>Remove the ability to specify HTTP config files with <code>chef-client -c http://blah.com/client.rb</code>.</p>

<h2>Motivation</h2>
<div class="highlight"><pre><span></span>As a Chef developer,
I want to not have to directly find and fix the unknown number of bugs where we assume config_file is a path,
so that I can write new features for Chef instead.

As a Chef user,
I am not using the ability to download a config file as a URL,
And I am much more interested in the Chef developers writing new features instead of fixing bugs in it.
</pre></div>
<h2>Specification</h2>

<ol>
<li>Get rid of all code that lets you treat Chef::Config.config_file as an HTTP or HTTPS URL (in ConfigFetcher primarily).</li>
<li>Make it an error when you specify a config file that does not exist.</li>
</ol>

<h2>Rationale</h2>

<p>There are already bugs in the chef-client because we assume client is a path (<code>config_dir</code> is <a href="https://github.com/opscode/chef/blob/master/lib/chef/config.rb#L84">File.dirname(<code>config_file</code>)</a>, and some <a href="https://github.com/opscode/chef/blob/master/lib/chef/config.rb#L365">rather crucial values</a> are inferred from <code>config_dir</code>).  While we could find and fix them all, we could also just make the code simpler by removing this capability.</p>

<h2>Impact and Workaround</h2>

<p>Anyone running <code>chef-client -c http://blah.com/client.rb</code> will get an error saying the config file does not exist.</p>

<p>I suspect the number of people this will affect is somewhere between 0 and 0.  No Chef-written servers export config directly and there are very real security concerns around it.  If those people exist, there are real bugs in the client that those people are hitting because of it, as well (see the <code>config_dir</code> issue in Rationale).  Hence this RFC, so we can discuss it.</p>

<p>Users who <em>are</em> doing this can restore the original effect by doing the following in <code>/etc/chef/client.rb</code>:</p>
<div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;net/http&#39;</span>
<span class="nb">instance_eval</span><span class="p">(</span><span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;blah.com&#39;</span><span class="p">,</span> <span class="s1">&#39;/client.rb&#39;</span><span class="p">))</span>
</pre></div>
<h2>Copyright</h2>

<p>This work is in the public domain. In jurisdictions that do not allow for this,
this work is available under CC0. To the extent possible under law, the person
who associated CC0 with this work has waived all copyright and related or
neighboring rights to this work.</p>
    </div>
  </body>
</html>
