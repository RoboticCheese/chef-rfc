<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable = no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation-essential/6.2.2/css/foundation.min.css">
    <style>
      a { color: #f18b21; }
      a:hover, a:focus { color: #3f5364; }
    </style>
    <title>Chef RFCs</title>
  </head>
  <body>
    <div class="row medium-12 columns">
      <header class="clearfix">
        <div class="left">
          <a href="/chef-rfc"><h1>Chef RFCs</h1></a>
        </div>
      </header>
<h1>Powershell DSC Resource Modules</h1>

<p>This document is a request for suggestions on DSC module resource for <a href="https://github.com/chef-windows/powershell">PowerShell</a> cookbook provided by chef.</p>

<h2>Quick overview of DSC resource module</h2>

<ul>
<li>Desired State Configuration is Microsoft’s technology, introduced in Windows Management Framework 4.0, for declarative configuration of systems. At the risk of oversimplifying a bit, DSC lets you create specially formatted text files that describe how a system should be configured. You then deploy those files to the actual systems, and they magically configure themselves as directed. At the top level DSC uses domain specific language that just listing how you want a system to look.</li>
<li>It works like: (step 1) write a configuration script in PowerShell. Then you (step 2) run that script, and the result is one or more MOF files. MOF stands for Managed Object Format, and it’s basically a specially formatted text file. Then, (step 3), the MOF files are somehow conveyed to the machines they’re meant for, and (step 4) those machines start configuring themselves to match what the MOF says.</li>
<li>DSC configuration block includes in-built and custom DSC resources.</li>
<li>Example:</li>
</ul>
<div class="highlight"><pre><span></span>Configuration MyWebConfig
{
   # A Configuration block can have zero or more Node blocks
   Node &quot;Server001&quot;
   {
      # Next, specify one or more resource blocks
      # File is a built-in resource you can use to manage files and directories
      # This example ensures files from the source directory are present
      File MyFileExample
      {
         # You can also set Ensure to &quot;Absent&quot;
         Ensure = &quot;Present&quot;
         # Default is “File”
         Type = &quot;Directory&quot;
         Recurse = $true
         SourcePath = $WebsiteFilePath
         DestinationPath = &quot;C:\inetpub\wwwroot&quot;
      }
   }
}
</pre></div>
<ul>
<li>The Desired State Configuration (DSC) resource is a PowerShell module that is used to model one or more entities that you want to be in a specific, desired state.</li>
<li>There are certain rules which must be followed by custom DSC resource.</li>
<li>All DSC resources should be deployed in the following folder hierarchy:</li>
</ul>
<div class="highlight"><pre><span></span>$env: psmodulepath (folder)
  |- &lt;ModuleName&gt; (folder)
    |-  &lt;ModuleName.psd1&gt; (file,required)
    |- DSCResources (folder)
      |- &lt;DSCResourceName1&gt; (folder)
        |- &lt;DSCResourceName1.psd1&gt; (file, optional)
        |- &lt;DSCResourceName1.psm1&gt; (file, required)
        |- &lt;DSCResourceName1.schema.mof&gt; (file, required)
      |- &lt;DSCResourceName2&gt;(folder)
        |- &lt;DSCResourceName2.psd1&gt; (file, optional)
        |- &lt;DSCResourceName2.psm1&gt; (file, required)
        |- &lt;DSCResourceName2.schema.mof&gt; (file, required)
</pre></div>
<ul>
<li>DSC introduced Import-DscResource dynamic keyword to import custom DSC resources. This keyword is only available inside configuration block.</li>
<li>The Import-DscResource command will loop through all modules installed in all paths in $env:PSModulePath to find the ones containing resources</li>
</ul>

<h2>Goal</h2>

<p>The goal of the changes mentioned in this document is to manage custom DSC resource modules for desired workstation. This change is required for user to easily allow access for custom DSC resources. Currently there is no automated way to manage custom resources.  We are adding DSC module resource to PowerShell cookbook to manage (i.e install/uninstall) custom resource.</p>

<h2>Requirements</h2>

<p>The resource have meaningful name, <code>powershell_dsc_module</code>.</p>

<h2>Actions</h2>

<h3>:install <em>(default)</em></h3>

<p>It will install DSC module. User can use this module in configuration block by using &#39;Import-DscResource&#39;.</p>

<h3>:uninstall</h3>

<p>It will remove DSC module by deleting DSC resource module dir from $psmodulepath location.</p>

<h2>Attributes</h2>

<ul>
<li>module_name - The name of the module and its mandatory.</li>
<li>remote_url - The remote url for *.zip DSC module file. Its mandatory attribute. The zip file should have the same folder structure required for DSC module (see Quick overview of DSC resource module section).</li>
<li>version - DSC module may have multiple versions. Optional.</li>
</ul>

<h2>Example</h2>
<div class="highlight"><pre><span></span><span class="n">powershell_dsc_module</span> <span class="s2">&quot;test_module&quot;</span> <span class="k">do</span>
  <span class="n">module_name</span> <span class="s2">&quot;test_module&quot;</span>
  <span class="n">remote_url</span> <span class="s2">&quot;https://s3.aws.com/test_module.zip&quot;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="n">powershell_dsc_module</span> <span class="s2">&quot;test_module&quot;</span> <span class="k">do</span>
  <span class="n">module_name</span> <span class="s2">&quot;test_module&quot;</span>
  <span class="n">action</span> <span class="ss">:uninstall</span>
<span class="k">end</span>
</pre></div>
<h2>Copyright</h2>

<p>This work is in the public domain. In jurisdictions that do not allow for this,
this work is available under CC0. To the extent possible under law, the person
who associated CC0 with this work has waived all copyright and related or
neighboring rights to this work.</p>
    </div>
  </body>
</html>
